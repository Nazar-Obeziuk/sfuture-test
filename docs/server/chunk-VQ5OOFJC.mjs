import './polyfills.server.mjs';
import{a as G}from"./chunk-MPGMLXF3.mjs";import{a as q}from"./chunk-M4DRINL5.mjs";import{B as O,C as k,E as L,F as v,H as b,I as S,K as d,L as w,P as l}from"./chunk-5IG6QJXX.mjs";import{T as _,U as P,_ as N,da as Z,ea as Y,fa as J,ga as h,ha as u,ia as M,n as y,oa as E,q as x,ra as I,s as T,sa as W,va as B,xa as z,ya as H}from"./chunk-KQAQM22D.mjs";import{a as R,h as D}from"./chunk-MZKWKPOA.mjs";import X from"crypto";var U=new Uint8Array(256),C=U.length;function $(){return C>U.length-16&&(X.randomFillSync(U),C=0),U.slice(C,C+=16)}var o=[];for(let r=0;r<256;++r)o.push((r+256).toString(16).slice(1));function K(r,n=0){return o[r[n+0]]+o[r[n+1]]+o[r[n+2]]+o[r[n+3]]+"-"+o[r[n+4]]+o[r[n+5]]+"-"+o[r[n+6]]+o[r[n+7]]+"-"+o[r[n+8]]+o[r[n+9]]+"-"+o[r[n+10]]+o[r[n+11]]+o[r[n+12]]+o[r[n+13]]+o[r[n+14]]+o[r[n+15]]}import ee from"crypto";var F={randomUUID:ee.randomUUID};function te(r,n,g){if(F.randomUUID&&!n&&!r)return F.randomUUID();r=r||{};let e=r.random||(r.rng||$)();if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,n){g=g||0;for(let t=0;t<16;++t)n[g+t]=e[t];return n}return K(e)}var j=te;var V=(()=>{let n=class n{constructor(e){this.afs=e,this.scheduleCollection=O(this.afs,"users")}getOneUser(e){let t=d(this.afs,`users/${e}`);return v(t,{idField:"id"})}setUserScheduleDay(e,t){let i=d(this.afs,"users",e);return l(i,{sheduleWeeks:S(t)})}updateUser(e,t){let i=d(this.afs,`users/${t}`);return l(i,R({},e))}updateUserScheduleDay(e,t,i){return D(this,null,function*(){let s=d(this.afs,"users",e),a=(yield w(s)).data(),c=a.sheduleWeeks.findIndex(m=>m.id===t);return c!==-1?(a.sheduleWeeks[c]=i,l(s,{sheduleWeeks:a.sheduleWeeks})):(console.error(`Exercise with ID ${t} not found in userExercises`),Promise.reject(`Exercise with ID ${t} not found in userExercises`))})}isSameDay(e,t){return e===t}deleteUserExercise(e,t){let i=d(this.afs,"users",e);return l(i,{sheduleWeeks:b(t)})}};n.\u0275fac=function(t){return new(t||n)(x(k))},n.\u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function ie(r,n){if(r&1&&(h(0,"div",12)(1,"div",13),M(2,"div",14),u(),h(3,"h5",15),I(4),z(5,"slice"),u()()),r&2){let g=n.$implicit;_(2),N("height",g.percentCount,"%"),_(2),W(H(5,3,g.nameOfDay,0,3))}}var ke=(()=>{let n=class n{constructor(e,t){this.userExerciseService=e,this.schedulerService=t,this.lengthOfAllUserExercises=[],this.percentCount=0,this.today=new Date,this.daysOfWeek=[]}ngOnInit(){this.getPersonalData(),this.updateWeekRange(),this.setTodaysDay(),this.getPercentOfAcitivity(),this.getWeekData()}getPersonalData(){let e=localStorage.getItem("currentUser");this.currentUserId=e?JSON.parse(e):void 0}getStartAndEndOfWeek(){let e=(this.startDate.getMonth()+1).toString(),t=this.startDate.getDate().toString(),i=(this.endDate.getMonth()+1).toString(),s=this.endDate.getDate().toString();t.length===1&&(t="0"+t),s.length===1&&(s="0"+s),e.length===1&&(e="0"+e),i.length===1&&(i="0"+i),this.weekInterval=`${t}.${e}.${this.startDate.getFullYear()} - ${s}.${i}.${this.endDate.getFullYear()}`}updateWeekRange(){let e=new Date(this.today);e.setDate(this.today.getDate()-this.today.getDay());let t=new Date(this.today);t.setDate(this.today.getDate()+(6-this.today.getDay())),this.startDate=e,this.endDate=t,this.getStartAndEndOfWeek(),this.generateDaysOfWeek()}setTodaysDay(){let e=`${this.padZero(this.today.getDate())}.${this.padZero(this.today.getMonth()+1)}.${this.today.getFullYear()}`;this.getPersonalData(),localStorage.getItem("currentUser")&&this.userExerciseService.getOneUser(this.currentUserId.uid).subscribe(t=>{let i=t;this.daysOfWeek.forEach(s=>{let p=i.sheduleWeeks.some(a=>this.isSameDate(s.date,a.date));s.date===e&&(p||this.schedulerService.setUserScheduleDay(this.currentUserId.uid,s).then(()=>{}).catch(a=>console.log(a)))})})}isSameDate(e,t){return e===t}generateDaysOfWeek(){this.daysOfWeek=[];for(let e=0;e<7;e++){let t=new Date(this.startDate);t.setDate(t.getDate()+e);let i=t.getDate(),s=t.getMonth()+1,p=t.getFullYear(),a=`${this.padZero(i)}.${this.padZero(s)}.${p}`,c={id:j(),date:a,nameOfDay:this.getDayName(t.getDay()),percentCount:0};this.daysOfWeek.push(c)}}padZero(e){return e<10?`0${e}`:`${e}`}getDayName(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}previousWeek(){this.startDate.setDate(this.startDate.getDate()-7),this.endDate.setDate(this.endDate.getDate()-7),this.getStartAndEndOfWeek(),this.generateDaysOfWeek(),this.getPercentOfAcitivity()}nextWeek(){this.startDate.setDate(this.startDate.getDate()+7),this.endDate.setDate(this.endDate.getDate()+7),this.getStartAndEndOfWeek(),this.generateDaysOfWeek(),this.getPercentOfAcitivity()}getPercentOfAcitivity(){let e=`${this.padZero(this.today.getDate())}.${this.padZero(this.today.getMonth()+1)}.${this.today.getFullYear()}`;this.getPersonalData(),localStorage.getItem("currentUser")&&this.userExerciseService.getOneUser(this.currentUserId.uid).subscribe(s=>{let p=s;this.lengthOfAllUserExercises=p.userExercises;let a=this.lengthOfAllUserExercises.filter(c=>c.completed===!0);this.percentCount=a.length/this.lengthOfAllUserExercises.length*100,this.schedulerService.getOneUser(this.currentUserId.uid).subscribe(c=>{c.sheduleWeeks.forEach(f=>{e===f.date&&(f.percentCount=this.percentCount,localStorage.setItem("currentSheduleDay",JSON.stringify(f))),this.daysOfWeek.forEach(A=>{A.date===f.date&&(A.percentCount=f.percentCount)})})})});let t=localStorage.getItem("currentSheduleDay"),i=t?JSON.parse(t):void 0;i.percentCount>0&&this.schedulerService.updateUserScheduleDay(this.currentUserId.uid,i.id,i).then(()=>{}).catch(s=>console.log(s))}getWeekData(){this.getPersonalData(),localStorage.getItem("currentUser")&&this.schedulerService.getOneUser(this.currentUserId.uid).subscribe(e=>{let t=e;this.daysOfWeek.forEach(i=>{t.sheduleWeeks.forEach(s=>{i.date===s.date&&(i.percentCount=s.percentCount)})})})}};n.\u0275fac=function(t){return new(t||n)(P(q),P(V))},n.\u0275cmp=T({type:n,selectors:[["app-schedule"]],standalone:!0,features:[B],decls:19,vars:1,consts:[[1,"container"],[1,"block"],[1,"block__wrapper"],[1,"block__top_header"],["src","assets/images/previous-icon.svg","alt","",1,"top__header_prev",3,"click"],[1,"top__header_title"],["src","assets/images/next-icon.svg","alt","",1,"top__header_next",3,"click"],[1,"block__wrapper_bottom"],[1,"block__bottom_main"],[1,"bottom__main_line"],[1,"block__wrapper_top"],[1,"block__top_schedule"],[1,"block__top_col"],[1,"top__col_wrapper"],[1,"col__wrapper_item"],[1,"top__col_text"],["class","block__top_col"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"img",4),E("click",function(){return i.previousWeek()}),u(),h(5,"p",5),I(6),u(),h(7,"img",6),E("click",function(){return i.nextWeek()}),u()(),h(8,"div",7)(9,"div",8),M(10,"div",9)(11,"div",9)(12,"div",9)(13,"div",9)(14,"div",9),u(),h(15,"div",10)(16,"div",11),Y(17,ie,6,7,"div",16,Z),u()()()()()()),t&2&&(_(6),W(i.weekInterval),_(11),J(i.daysOfWeek))},dependencies:[G],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{width:590px;height:340px}.block[_ngcontent-%COMP%]{width:100%;height:100%;border:1px solid #f5f5f5;border-radius:10px}.block__wrapper[_ngcontent-%COMP%]{height:100%}.block__wrapper_bottom[_ngcontent-%COMP%]{height:248px;position:relative}.block__wrapper_top[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.block__bottom_main[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;flex-direction:column}.block__top_header[_ngcontent-%COMP%]{padding:30px;width:100%;display:flex;align-items:center;justify-content:space-between}.block__top_schedule[_ngcontent-%COMP%]{padding:0 30px;width:586px;display:flex;align-items:center;justify-content:space-between}.block__top_col[_ngcontent-%COMP%]{width:50px;height:230px;display:flex;align-items:center;justify-content:space-between;flex-direction:column}.bottom__main_line[_ngcontent-%COMP%]{width:100%;height:50px;border-top:1px dashed #f5f5f5}.top__header_title[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.top__header_prev[_ngcontent-%COMP%], .top__header_next[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;cursor:pointer}.top__col_wrapper[_ngcontent-%COMP%]{height:200px;width:100%;display:flex;align-items:flex-end}.col__wrapper_item[_ngcontent-%COMP%]{width:100%;background:#9ECEFF;border-radius:10px}.today[_ngcontent-%COMP%]{color:red}@media (max-width: 440px){.container[_ngcontent-%COMP%]{width:100%}.block[_ngcontent-%COMP%]{width:100%;height:320px}.block__wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.block__wrapper_bottom[_ngcontent-%COMP%]{height:248px}.block__wrapper_top[_ngcontent-%COMP%]{width:100%}.block__top_header[_ngcontent-%COMP%]{padding:20px;width:100%}.block__top_schedule[_ngcontent-%COMP%]{padding:0 10px;width:100%}.block__top_col[_ngcontent-%COMP%]{width:10%;height:230px}.block__bottom_main[_ngcontent-%COMP%]{width:100%}.top__header_title[_ngcontent-%COMP%]{font-size:14px}.top__header_next[_ngcontent-%COMP%], .top__header_prev[_ngcontent-%COMP%]{width:10px;height:14px}.block__bottom_main[_ngcontent-%COMP%]   .bottom__main_line[_ngcontent-%COMP%]:last-child{height:40px}}']});let r=n;return r})();var we=(()=>{let n=class n{constructor(e){this.afs=e,this.userCollection=O(this.afs,"users")}getAllUsers(){return L(this.userCollection,{idField:"id"})}getOneUser(e){let t=d(this.afs,`users/${e}`);return v(t,{idField:"id"})}setUserCoach(e,t){let i=d(this.afs,"users",e);return l(i,{coaches:S(t)})}updateUserCoach(e,t,i){return D(this,null,function*(){let s=d(this.afs,"users",e),a=(yield w(s)).data(),c=a.userExercises.findIndex(m=>m.id===t);return c!==-1?(a.coaches[c]=i,l(s,{coaches:a.coaches})):(console.error(`Exercise with ID ${t} not found in userExercises`),Promise.reject(`Exercise with ID ${t} not found in userExercises`))})}deleteUserCoach(e,t){let i=d(this.afs,"users",e);return l(i,{coaches:b(t)})}};n.\u0275fac=function(t){return new(t||n)(x(k))},n.\u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();export{ke as a,we as b};
